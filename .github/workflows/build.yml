name: Build TikTokPro Tweak

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    env:
      THEOS: ${{ github.workspace }}/theos

    steps:
      # الخطوة 1: سحب الكود مع المشاريع الفرعية (Theos)
      - name: Checkout Source Code with Submodules
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'

      # الخطوة 2: تثبيت الأدوات المطلوبة
      - name: Install Dependencies
        run: |
          brew install ldid xz

      # الخطوة 3: تثبيت حزمة SDK
      - name: Install SDK
        run: |
          curl -LO https://github.com/theos/sdks/releases/download/master-146e41f/iPhoneOS16.5.sdk.tar.xz
          tar -xf iPhoneOS16.5.sdk.tar.xz -C $THEOS/sdks/

      # الخطوة 4: بناء وتغليف الأداة
      - name: Build Tweak
        run: |
          cd TikTokPro
          make clean package

      # الخطوة 5: (جديد) حفظ ملف .deb الناتج كـ Artifact
      # هذا سيسمح لك بتحميل الملف مباشرة بعد انتهاء عملية البناء
      - name: Upload .deb as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tiktokpro-deb
          path: TikTokPro/packages/*.deb

# --- تم حذف الخطوات التالية ---
# - name: Create GitHub Release
# - name: Upload Tweak .deb to Release
